var books=[{title:"The Colour of Magic",cover:"images/covers/Cover_The_Colour_Of_Magic.jpg",links:{amazon:"http://www.amazon.co.uk/dp/0552124753"},characters:["Bel-Shamharoth","Hrun, the Barbarian","Liessa Wyrmbidder","the Luggage","Rincewind","Twoflower"],locations:["Agatean Empire","Ankh-Morpork","Chirm","Dunmanifestin","Krull","Wyrmberg"]},{title:"The Light Fantastic",cover:"images/covers/Cover_The_Light_Fantastic.jpg",links:{amazon:"http://www.amazon.co.uk/dp/055216660X"},characters:["Conan","Ymper Trymon","the Luggage","Rincewind","Twoflower"],locations:["Ankh-Morpork","Unseen University","Death's Domain","Dungeon Dimensions","Vortex Plains","Krull","Trollbone Mountains"]},{title:"Equal Rites",cover:"images/covers/Equal_Rites.jpg",links:{amazon:"http://www.amazon.co.uk/dp/0552166618"},characters:["Granny Weatherwax","Eskarina Smith","Simon","Drum Billet","Archchancellor Cutangle"],locations:["Ramtop Mountains","Ankh-Morpork","Unseen University","River Ankh"]},{title:"Mort",cover:"images/covers/Cover_Mort.jpg",links:{amazon:"http://www.amazon.co.uk/dp/0552166626"},characters:["Death","Mort","Ysabell","Binky","Albert","Keli"],locations:["Death's Domain","Ramtops","Ankh-Morpork","Sto Lat","Patrician's Palace"]}];!function(a){"use strict";var e=a("#book_list"),o=a("#character"),n=a("#location"),t=[],i=[];a.each(books,function(o,n){n.serializedCharacters=JSON.stringify(this.characters),n.serializedLocations=JSON.stringify(this.locations),e.append(Discworld.templates.book(n)),a.each(n.characters,function(a,e){-1===t.indexOf(e)&&t.push(e)}),a.each(n.locations,function(a,e){-1===i.indexOf(e)&&i.push(e)})});var r=e.find("img"),s=new imagesLoaded(r.get());s.on("always",function(){e.shuffle({itemSelector:".book"})});var c=function(){var a=o.val(),t=n.val();console.log([a,t]),e.shuffle("shuffle",function(e){return!(null!==a&&_.intersection(e.data("characters"),a).length!==a.length||null!==t&&_.intersection(e.data("locations"),t).length!==t.length)})};t.sort(),a.each(t,function(e,n){o.append(a("<option></option>").attr("value",n).text(n))}),o.on("change",c),o.chosen(),i.sort(),a.each(i,function(e,o){n.append(a("<option></option>").attr("value",o).text(o))}),n.on("change",c),n.chosen()}(jQuery);