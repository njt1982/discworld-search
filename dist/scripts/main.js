var books=[{title:"The Colour of Magic",cover:"images/covers/Cover_The_Colour_Of_Magic.jpg",links:{amazon:"http://www.amazon.co.uk/dp/0552124753"},characters:["Bel-Shamharoth","Hrun, the Barbarian","Liessa Wyrmbidder","the Luggage","Rincewind","Twoflower"],locations:["Agatean Empire","Ankh-Morpork","Chirm","Dunmanifestin","Krull","Wyrmberg"]},{title:"The Light Fantastic",cover:"images/covers/Cover_The_Light_Fantastic.jpg",links:{amazon:"http://www.amazon.co.uk/dp/055216660X"},characters:["Conan","Ymper Trymon","the Luggage","Rincewind","Twoflower"],locations:["Ankh-Morpork","Unseen University","Death's Domain","Dungeon Dimensions","Vortex Plains","Krull","Trollbone Mountains"]},{title:"Equal Rites",cover:"images/covers/Equal_Rites.jpg",links:{amazon:"http://www.amazon.co.uk/dp/0552166618"},characters:["Granny Weatherwax","Eskarina Smith","Simon","Drum Billet","Archchancellor Cutangle"],locations:["Ramtop Mountains","Ankh-Morpork","Unseen University","River Ankh"]},{title:"Mort",cover:"images/covers/Cover_Mort.jpg",links:{amazon:"http://www.amazon.co.uk/dp/0552166626"},characters:["Death","Mort","Ysabell","Binky","Albert","Keli"],locations:["Death's Domain","Ramtops","Ankh-Morpork","Sto Lat","Patrician's Palace"]}];!function(a){"use strict";var o=a("#book_list"),e=a("#character"),t=a("#location"),n=[],i=[];a.each(books,function(e,t){t.serializedCharacters=JSON.stringify(this.characters),t.serializedLocations=JSON.stringify(this.locations),o.append(Discworld.templates.book(t)),a.each(t.characters,function(a,o){-1===n.indexOf(o)&&n.push(o)}),a.each(t.locations,function(a,o){-1===i.indexOf(o)&&i.push(o)})});var r=o.find("img"),s=new imagesLoaded(r.get());s.on("always",function(){o.shuffle({itemSelector:".book"})});var c=function(){var a=e.val(),n=t.val();o.shuffle("shuffle",function(o){return!(""!==a&&-1===o.data("characters").indexOf(a)||""!==n&&-1===o.data("locations").indexOf(n))})};n.sort(),a.each(n,function(o,t){e.append(a("<option></option>").attr("value",t).text(t))}),e.on("change",c),i.sort(),a.each(i,function(o,e){t.append(a("<option></option>").attr("value",e).text(e))}),t.on("change",c)}(jQuery);